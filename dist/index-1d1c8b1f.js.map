{"version":3,"file":"index-1d1c8b1f.js","sources":["../src/decoder/decodeData/BitStream.ts","../src/decoder/decodeData/index.ts"],"sourcesContent":["// tslint:disable:no-bitwise\n\nimport { Mode, ModeByte } from \".\";\n\nexport enum StreamMapping {\n  Padding = -1,\n  Mode = -2,\n  CharacterCountInfo = -3,\n  // structured append\n  SACurrentSequence = -4,\n  SATotalSequence = -5,\n  SAParity = -6,\n  ECIData = -7,\n}\n\nexport interface StreamInfo {\n  mode: Mode;\n  length: number;\n  mapping?: StreamMapping;\n  charIndex?: number;\n  data: number;\n}\n\nexport class BitStream {\n  private bytes: Uint8ClampedArray;\n  private byteOffset: number = 0;\n  private bitOffset: number = 0;\n\n  private charsRead: number = 0;\n  // {start bit, [length, mapping]}\n  private mappings: Map<number, StreamInfo> = null;\n\n  constructor(bytes: Uint8ClampedArray, doMapping = true) {\n    this.bytes = bytes;\n    if (doMapping) {\n      this.mappings = new Map<number, StreamInfo>();\n    }\n  }\n\n  public readBits(\n    numBits: number,\n    mode: Mode,\n    mapping?: StreamMapping,\n  ): number {\n    if (numBits < 1 || numBits > 32 || numBits > this.available()) {\n      throw new Error(\"Cannot read \" + numBits.toString() + \" bits\");\n    }\n    let remaining = numBits;\n\n    const key = this.byteOffset * 8 + this.bitOffset;\n    let result = 0;\n    // First, read remainder from current byte\n    if (this.bitOffset > 0) {\n      const bitsLeft = 8 - this.bitOffset;\n      const toRead = remaining < bitsLeft ? remaining : bitsLeft;\n      const bitsToNotRead = bitsLeft - toRead;\n      const mask = (0xff >> (8 - toRead)) << bitsToNotRead;\n      result = (this.bytes[this.byteOffset] & mask) >> bitsToNotRead;\n      remaining -= toRead;\n      this.bitOffset += toRead;\n      if (this.bitOffset === 8) {\n        this.bitOffset = 0;\n        this.byteOffset++;\n      }\n    }\n\n    // Next read whole bytes\n    if (remaining > 0) {\n      while (remaining >= 8) {\n        result = (result << 8) | (this.bytes[this.byteOffset] & 0xff);\n        this.byteOffset++;\n        remaining -= 8;\n      }\n\n      // Finally read a partial byte\n      if (remaining > 0) {\n        const bitsToNotRead = 8 - remaining;\n        const mask = (0xff >> bitsToNotRead) << bitsToNotRead;\n        result =\n          (result << remaining) |\n          ((this.bytes[this.byteOffset] & mask) >> bitsToNotRead);\n        this.bitOffset += remaining;\n      }\n    }\n\n    if (mapping === StreamMapping.Mode) {\n      switch (result as ModeByte) {\n        case ModeByte.Terminator:\n          mode = Mode.None;\n          break;\n        case ModeByte.Numeric:\n          mode = Mode.Numeric;\n          break;\n        case ModeByte.Alphanumeric:\n          mode = Mode.Alphanumeric;\n          break;\n        case ModeByte.Byte:\n          mode = Mode.Byte;\n          break;\n        case ModeByte.Kanji:\n          mode = Mode.Kanji;\n          break;\n        case ModeByte.ECI:\n          mode = Mode.ECI;\n          break;\n        case ModeByte.StructuredAppend:\n          mode = Mode.StructuredAppend;\n          break;\n      }\n    }\n\n    this.mappings?.set(key, {\n      mode,\n      length: numBits,\n      mapping,\n      charIndex: mapping ? undefined : this.charsRead++,\n      data: result,\n    });\n\n    return result;\n  }\n\n  public available(): number {\n    return 8 * (this.bytes.length - this.byteOffset) - this.bitOffset;\n  }\n\n  public getMappings() {\n    return this.mappings;\n  }\n}\n","// tslint:disable:no-bitwise\nimport { BitStream, StreamInfo, StreamMapping } from \"./BitStream\";\n\nexport interface Chunk {\n  type: Mode;\n  text: string;\n}\n\nexport interface ByteChunk {\n  type: Mode.Byte | Mode.Kanji;\n  bytes: number[];\n}\n\nexport interface ECIChunk {\n  type: Mode.ECI;\n  assignmentNumber: number;\n}\n\nexport interface StructuredAppend {\n  type: Mode.StructuredAppend;\n  currentSequence: number;\n  totalSequence: number;\n  parity: number;\n}\n\nexport type Chunks = Array<Chunk | ByteChunk | ECIChunk | StructuredAppend>;\n\nexport interface DecodedQR {\n  text: string;\n  bytes: number[];\n  chunks: Chunks;\n  version: number;\n  mirrored: boolean;\n  ecLevel: number;\n  dataMask: number;\n  streamMappings: Map<number, StreamInfo>;\n}\n\ninterface DecodeTextResult {\n  bytes: number[];\n  text: string;\n}\n\nexport enum Mode {\n  Numeric = \"numeric\",\n  Alphanumeric = \"alphanumeric\",\n  Byte = \"byte\",\n  Kanji = \"kanji\",\n  ECI = \"eci\",\n  StructuredAppend = \"structuredappend\",\n  None = \"none\",\n}\n\nexport enum ModeByte {\n  Terminator = 0x0,\n  Numeric = 0x1,\n  Alphanumeric = 0x2,\n  Byte = 0x4,\n  Kanji = 0x8,\n  ECI = 0x7,\n  StructuredAppend = 0x3,\n  // FNC1FirstPosition = 0x5,\n  // FNC1SecondPosition = 0x9,\n}\n\nexport function decodeNumeric(\n  stream: BitStream,\n  size: number,\n  textOnly = false,\n): DecodeTextResult | string {\n  let bytes: number[];\n  if (!textOnly) bytes = [];\n  let text = \"\";\n\n  const characterCountSize = [10, 12, 14][size];\n  let length = stream.readBits(\n    characterCountSize,\n    Mode.Numeric,\n    StreamMapping.CharacterCountInfo,\n  );\n  // Read digits in groups of 3\n  while (length >= 3) {\n    const num = stream.readBits(10, Mode.Numeric);\n    if (num >= 1000) {\n      throw new Error(\"Invalid numeric value above 999\");\n    }\n\n    const a = Math.floor(num / 100);\n    const b = Math.floor(num / 10) % 10;\n    const c = num % 10;\n\n    if (!textOnly) bytes.push(48 + a, 48 + b, 48 + c);\n    text += a.toString() + b.toString() + c.toString();\n    length -= 3;\n  }\n\n  // If the number of digits aren't a multiple of 3, the remaining digits are special cased.\n  if (length === 2) {\n    const num = stream.readBits(7, Mode.Numeric);\n    if (num >= 100) {\n      throw new Error(\"Invalid numeric value above 99\");\n    }\n\n    const a = Math.floor(num / 10);\n    const b = num % 10;\n\n    if (!textOnly) bytes.push(48 + a, 48 + b);\n    text += a.toString() + b.toString();\n  } else if (length === 1) {\n    const num = stream.readBits(4, Mode.Numeric);\n    if (num >= 10) {\n      throw new Error(\"Invalid numeric value above 9\");\n    }\n\n    if (!textOnly) bytes.push(48 + num);\n    text += num.toString();\n  }\n\n  if (!textOnly) return { bytes, text };\n  else return text;\n}\n\nexport const AlphanumericCharacterCodes = [\n  \"0\",\n  \"1\",\n  \"2\",\n  \"3\",\n  \"4\",\n  \"5\",\n  \"6\",\n  \"7\",\n  \"8\",\n  \"9\",\n  \"A\",\n  \"B\",\n  \"C\",\n  \"D\",\n  \"E\",\n  \"F\",\n  \"G\",\n  \"H\",\n  \"I\",\n  \"J\",\n  \"K\",\n  \"L\",\n  \"M\",\n  \"N\",\n  \"O\",\n  \"P\",\n  \"Q\",\n  \"R\",\n  \"S\",\n  \"T\",\n  \"U\",\n  \"V\",\n  \"W\",\n  \"X\",\n  \"Y\",\n  \"Z\",\n  \" \",\n  \"$\",\n  \"%\",\n  \"*\",\n  \"+\",\n  \"-\",\n  \".\",\n  \"/\",\n  \":\",\n];\n\nexport function decodeAlphanumeric(\n  stream: BitStream,\n  size: number,\n  textOnly = false,\n): DecodeTextResult | string {\n  let bytes: number[];\n  if (!textOnly) bytes = [];\n  let text = \"\";\n\n  const characterCountSize = [9, 11, 13][size];\n  let length = stream.readBits(\n    characterCountSize,\n    Mode.Alphanumeric,\n    StreamMapping.CharacterCountInfo,\n  );\n  while (length >= 2) {\n    const v = stream.readBits(11, Mode.Alphanumeric);\n\n    const a = Math.floor(v / 45);\n    const b = v % 45;\n\n    if (!textOnly)\n      bytes.push(\n        AlphanumericCharacterCodes[a].charCodeAt(0),\n        AlphanumericCharacterCodes[b].charCodeAt(0),\n      );\n    text += AlphanumericCharacterCodes[a] + AlphanumericCharacterCodes[b];\n    length -= 2;\n  }\n\n  if (length === 1) {\n    const a = stream.readBits(6, Mode.Alphanumeric);\n    if (!textOnly) bytes.push(AlphanumericCharacterCodes[a].charCodeAt(0));\n    text += AlphanumericCharacterCodes[a];\n  }\n\n  if (!textOnly) return { bytes, text };\n  else return text;\n}\n\nexport function decodeByte(\n  stream: BitStream,\n  size: number,\n  textOnly = false,\n): DecodeTextResult | string {\n  const bytes: number[] = [];\n  let text = \"\";\n\n  const characterCountSize = [8, 16, 16][size];\n  const length = stream.readBits(\n    characterCountSize,\n    Mode.Byte,\n    StreamMapping.CharacterCountInfo,\n  );\n  for (let i = 0; i < length; i++) {\n    const b = stream.readBits(8, Mode.Byte);\n    bytes.push(b);\n  }\n\n  const decoder = new TextDecoder(\"utf-8\");\n  // for (const byte of bytes) {\n  //   try {\n  //     // text += decodeURIComponent(`%${(\"0\" + byte.toString(16)).slice(-2)}`);\n  //   } catch {\n  //     console.error(\"Failed to decode ASCII character:\", byte.toString(16));\n  //   }\n  // }\n  text += decoder.decode(new Uint8Array(bytes));\n\n  if (!textOnly) return { bytes, text };\n  else return text;\n}\n\nexport function decodeKanji(\n  stream: BitStream,\n  size: number,\n  textOnly = false,\n): DecodeTextResult | string {\n  const bytes: number[] = [];\n\n  const characterCountSize = [8, 10, 12][size];\n  const length = stream.readBits(\n    characterCountSize,\n    Mode.Kanji,\n    StreamMapping.CharacterCountInfo,\n  );\n  for (let i = 0; i < length; i++) {\n    const k = stream.readBits(13, Mode.Kanji);\n\n    let c = (Math.floor(k / 0xc0) << 8) | k % 0xc0;\n    if (c < 0x1f00) {\n      c += 0x8140;\n    } else {\n      c += 0xc140;\n    }\n\n    bytes.push(c >> 8, c & 0xff);\n  }\n\n  const text = new TextDecoder(\"shift-jis\").decode(Uint8Array.from(bytes));\n\n  if (!textOnly) return { bytes, text };\n  else return text;\n}\n\nexport function decode(data: Uint8ClampedArray, version: number): DecodedQR {\n  const stream = new BitStream(data);\n\n  // There are 3 'sizes' based on the version. 1-9 is small (0), 10-26 is medium (1) and 27-40 is large (2).\n  const size = version <= 9 ? 0 : version <= 26 ? 1 : 2;\n\n  const result: DecodedQR = {\n    text: \"\",\n    bytes: [],\n    chunks: [],\n    version,\n    mirrored: false,\n    ecLevel: -1,\n    dataMask: -1,\n    streamMappings: null,\n  };\n\n  while (stream.available() >= 4) {\n    const mode = stream.readBits(4, Mode.None, StreamMapping.Mode);\n    if (mode === ModeByte.Terminator) {\n      result.streamMappings = stream.getMappings();\n      return result;\n    } else if (mode === ModeByte.ECI) {\n      if (stream.readBits(1, Mode.ECI, StreamMapping.ECIData) === 0) {\n        result.chunks.push({\n          type: Mode.ECI,\n          assignmentNumber: stream.readBits(7, Mode.ECI),\n        });\n      } else if (stream.readBits(1, Mode.ECI, StreamMapping.ECIData) === 0) {\n        result.chunks.push({\n          type: Mode.ECI,\n          assignmentNumber: stream.readBits(14, Mode.ECI),\n        });\n      } else if (stream.readBits(1, Mode.ECI, StreamMapping.ECIData) === 0) {\n        result.chunks.push({\n          type: Mode.ECI,\n          assignmentNumber: stream.readBits(21, Mode.ECI),\n        });\n      } else {\n        // ECI data seems corrupted\n        result.chunks.push({\n          type: Mode.ECI,\n          assignmentNumber: -1,\n        });\n      }\n    } else if (mode === ModeByte.Numeric) {\n      const numericResult = decodeNumeric(stream, size) as DecodeTextResult;\n      result.text += numericResult.text;\n      result.bytes.push(...numericResult.bytes);\n      result.chunks.push({\n        type: Mode.Numeric,\n        text: numericResult.text,\n      });\n    } else if (mode === ModeByte.Alphanumeric) {\n      const alphanumericResult = decodeAlphanumeric(stream, size) as DecodeTextResult;\n      result.text += alphanumericResult.text;\n      result.bytes.push(...alphanumericResult.bytes);\n      result.chunks.push({\n        type: Mode.Alphanumeric,\n        text: alphanumericResult.text,\n      });\n    } else if (mode === ModeByte.Byte) {\n      const byteResult = decodeByte(stream, size) as DecodeTextResult;\n      result.text += byteResult.text;\n      result.bytes.push(...byteResult.bytes);\n      result.chunks.push({\n        type: Mode.Byte,\n        bytes: byteResult.bytes,\n        text: byteResult.text,\n      });\n    } else if (mode === ModeByte.Kanji) {\n      const kanjiResult = decodeKanji(stream, size) as DecodeTextResult;\n      result.text += kanjiResult.text;\n      result.bytes.push(...kanjiResult.bytes);\n      result.chunks.push({\n        type: Mode.Kanji,\n        bytes: kanjiResult.bytes,\n        text: kanjiResult.text,\n      });\n    } else if (mode === ModeByte.StructuredAppend) {\n      result.chunks.push({\n        type: Mode.StructuredAppend,\n        currentSequence: stream.readBits(\n          4,\n          Mode.StructuredAppend,\n          StreamMapping.SACurrentSequence,\n        ),\n        totalSequence: stream.readBits(\n          4,\n          Mode.StructuredAppend,\n          StreamMapping.SATotalSequence,\n        ),\n        parity: stream.readBits(\n          8,\n          Mode.StructuredAppend,\n          StreamMapping.SAParity,\n        ),\n      });\n    }\n  }\n\n  // If there is no data left, or the remaining bits are all 0, then that counts as a termination marker\n  if (\n    stream.available() === 0 ||\n    stream.readBits(stream.available(), Mode.None, StreamMapping.Padding) === 0\n  ) {\n    result.streamMappings = stream.getMappings();\n    return result;\n  }\n}\n"],"names":[],"mappings":"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"}